//ÊÄùËÄÉË¶Å‰∏çË¶ÅËΩâmoudles
"use client";

import React, { useState, useEffect, useRef } from "react";
import { useRouter } from "next/navigation";
import styles from "../../../styles/modules/fontHotelHome.module.css";
import "nouislider/dist/nouislider.css";
import noUiSlider from "nouislider";
import flatpickr from "flatpickr";
import "flatpickr/dist/flatpickr.min.css";
import { useLocationSelector } from "@/hooks/useLocationSelector";

export default function HotelHomePage() {
  const router = useRouter();
  const [quantity, setQuantity] = useState(1);
  const [minPrice, setMinPrice] = useState(0);
  const [maxPrice, setMaxPrice] = useState(10000);
  const priceSliderRef = useRef(null);
  const [showMore, setShowMore] = useState(false);

  const {
    location,
    locationModalRef,
    googleMapUrl,
    openModal,
    closeModal,
    confirmLocation,
    openMap,
  } = useLocationSelector();

  useEffect(() => {
    if (typeof window === "undefined") return;

    flatpickr("#date-date", {
      mode: "range",
      dateFormat: "Y-m-d",
      minDate: "today",
      locale: {
        firstDayOfWeek: 1,
        weekdays: {
          shorthand: ["Êó•", "‰∏Ä", "‰∫å", "‰∏â", "Âõõ", "‰∫î", "ÂÖ≠"],
          longhand: [
            "ÊòüÊúüÊó•",
            "ÊòüÊúü‰∏Ä",
            "ÊòüÊúü‰∫å",
            "ÊòüÊúü‰∏â",
            "ÊòüÊúüÂõõ",
            "ÊòüÊúü‰∫î",
            "ÊòüÊúüÂÖ≠",
          ],
        },
        rangeSeparator: " Ëá≥ ",
      },
    });

    if (!priceSliderRef.current) return;

    // ÂàùÂßãÂåñÊªëÊ°ø
    noUiSlider.create(priceSliderRef.current, {
      start: [minPrice, maxPrice],
      connect: true,
      range: { min: 0, max: 10000 },
      step: 100,
    });

    // ÊªëÊ°øÊõ¥Êñ∞ÊôÇÂêåÊ≠• `state`
    priceSliderRef.current.noUiSlider.on("change", (values) => {
      setMinPrice(parseFloat(values[0]));
      setMaxPrice(parseFloat(values[1]));
    });

    return () => {
      if (priceSliderRef.current?.noUiSlider) {
        priceSliderRef.current.noUiSlider.destroy();
      }
    };
  }, []);
  const handleMinPriceChange = (e) => {
    let value = e.target.value;
    if (value === "") {
      setMinPrice(""); // Ê∏ÖÁ©∫
      return;
    }

    value = Number(value);
    if (isNaN(value)) return;
    if (value < 0) value = 0;
    if (value > maxPrice) value = maxPrice;

    setMinPrice(value);

    // ÊªëÊ°ø‰∏çÊúÉÂΩ±Èüø‰ΩøÁî®ËÄÖËº∏ÂÖ•
    if (priceSliderRef.current?.noUiSlider) {
      priceSliderRef.current.noUiSlider.set([value, maxPrice]);
    }
  };

  const handleMaxPriceChange = (e) => {
    let value = e.target.value;
    if (value === "") {
      setMaxPrice(""); // Ê∏ÖÁ©∫
      return;
    }

    value = Number(value);
    if (isNaN(value)) return;
    if (value > 10000) value = 10000;
    if (value < minPrice) value = minPrice;

    setMaxPrice(value);

    if (priceSliderRef.current?.noUiSlider) {
      priceSliderRef.current.noUiSlider.set([minPrice, value]);
    }
  };
  return (
    <>
      <div className="suBody">
        <div
          className={styles.suSearchBg}
          style={{
            backgroundImage: `url("/hotel/hotel-images/services-banner-dog-boarding.2203041608391.jpg")`,
          }}
        >
          {" "}
          <div className="container mt-4">
            <div className={styles.suSearchBar}>
              <div className={styles.suSearchGroup}>
                <img
                  className={styles.suIcon}
                  src="/hotel/hotel-images/page-image/icon-search.png"
                  alt=""
                />
                <input
                  type="text"
                  className={styles.suSearchInput}
                  placeholder="ÊêúÂ∞ãÈóúÈçµÂ≠ó„ÄÅÂú∞ÂçÄ..."
                  value={location}
                  readOnly
                  onClick={openModal}
                />
              </div>
              <div className={styles.suSearchGroup}>
                <img
                  className={styles.suIcon}
                  src="/hotel/hotel-images/page-image/icon-Calendar.png"
                  alt=""
                />
                <input
                  type="text"
                  id="date-date"
                  className={styles.suSearchDate}
                  placeholder="ÂÖ•‰ΩèÊó•Êúü ‚Üí ÈÄÄÊàøÊó•Êúü"
                />
              </div>
              <div className={styles.suSearchGroup}>
                <img
                  className={styles.suIcon}
                  src="/hotel/hotel-images/page-image/Icon-mimi.png"
                  alt=""
                />
                <span className="text">Êï∏Èáè</span>
                <button
                  className={styles.suQuantityBtn}
                  onClick={() => setQuantity(quantity > 1 ? quantity - 1 : 1)}
                >
                  -
                </button>
                <span className={styles.suQuantityNumber}>{quantity}</span>
                <button
                  className={styles.suQuantityBtn}
                  onClick={() => setQuantity(quantity + 1)}
                >
                  +
                </button>
              </div>
              <button className={styles.suSearchBtn}>ÊêúÂ∞ã</button>
            </div>
          </div>
        </div>
        {/* Âú∞ÂçÄÈÅ∏Êìá Modal */}
        <div
          className="modal fade"
          ref={locationModalRef}
          tabIndex="-1"
          aria-hidden="true"
        >
          <div className="modal-dialog">
            <div className="modal-content">
              <div className="modal-header">
                <h5 className="modal-title">ÈÅ∏ÊìáÂú∞ÂçÄ</h5>
                <button
                  type="button"
                  className="btn-close"
                  data-bs-dismiss="modal"
                  onClick={closeModal}
                ></button>
              </div>
              <div className="modal-body">
                <div id="twzipcode">
                  <select className="county"></select>
                  <select className="district"></select>
                </div>
              </div>
              <div className="modal-footer">
                <button className="btn btn-primary" onClick={confirmLocation}>
                  Á¢∫ÂÆö
                </button>
              </div>
            </div>
          </div>
        </div>

        <div className="container mt-4">
          <div className="row">
            {/* ÁØ©ÈÅ∏ */}
            <aside className={`col-lg-3 ${styles.suSidebar}`}>
              <div
                className={styles.suMapCard}
                onClick={openMap}
                style={{ cursor: "pointer" }}
              >
                <button className={`btn btn-primary ${styles.suMapBtn}`}>
                  üìç ÊñºÂú∞Âúñ‰∏äÈ°ØÁ§∫
                </button>
                <img
                  src={googleMapUrl}
                  alt="Âú∞ÂúñÁ∏ÆÂúñ"
                  className={styles.suMapImg}
                />
              </div>

              {/* Ë®≠ÊñΩÁØ©ÈÅ∏ */}
              <div className={styles.suFilterGroup}>
                <h6 className={styles.suFilterTitle}>Ë®≠ÊñΩ</h6>
                <div className="form-check">
                  <input
                    className="form-check-input"
                    type="checkbox"
                    id="walk"
                  />
                  <label className="form-check-label" htmlFor="walk">
                    ÂÖçË≤ªÊï£Ê≠•
                  </label>
                </div>
                <div className="form-check">
                  <input
                    className="form-check-input"
                    type="checkbox"
                    id="pool"
                  />
                  <label className="form-check-label" htmlFor="pool">
                    Ê∏∏Ê≥≥Ê±†
                  </label>
                </div>
                <div className="form-check">
                  <input
                    className="form-check-input"
                    type="checkbox"
                    id="pets"
                  />
                  <label className="form-check-label" htmlFor="pets">
                    Êà∂Â§ñÈÅãÂãï
                  </label>
                </div>

                {/* È°ØÁ§∫Êõ¥Â§ö */}
                <span
                  className={styles.suShowMore}
                  onClick={() => setShowMore(!showMore)}
                  style={{
                    cursor: "pointer",
                    color: "#007bff",
                    display: "block",
                    marginTop: "10px",
                  }}
                >
                  {showMore ? "Êî∂Ëµ∑ ‚ñ≤" : "È°ØÁ§∫ÂÖ®ÈÉ® ‚ñº"}
                </span>

                {/* È°çÂ§ñË®≠ÊñΩÈÅ∏È†Ö */}
                {showMore && (
                  <div className="mt-2">
                    <div className="form-check">
                      <input
                        className="form-check-input"
                        type="checkbox"
                        id="wifi"
                      />
                      <label className="form-check-label" htmlFor="wifi">
                        ÂÖçË≤ª Wi-Fi
                      </label>
                    </div>
                    <div className="form-check">
                      <input
                        className="form-check-input"
                        type="checkbox"
                        id="spa"
                      />
                      <label className="form-check-label" htmlFor="spa">
                        SPA ÊåâÊë©
                      </label>
                    </div>
                    <div className="form-check">
                      <input
                        className="form-check-input"
                        type="checkbox"
                        id="gym"
                      />
                      <label className="form-check-label" htmlFor="gym">
                        ÂÅ•Ë∫´Êàø
                      </label>
                    </div>
                  </div>
                )}
              </div>

              {/* ÂÉπÊ†ºÁØ©ÈÅ∏ */}
              <div
                className={` text-center ${styles.suFilterGroup} ${styles.suPriceFilterContainer}`}
              >
                <h6 className={styles.suFilterTitle}>ÂÉπÊ†ºÁØ©ÈÅ∏</h6>
                <div className="d-flex justify-content-center gap-3">
                  <div className={styles.suPriceInput}>
                    <label htmlFor="filterMin">ÊúÄÂ∞ë</label>
                    <input
                      id="filterMin"
                      type="number"
                      value={minPrice === "" ? "" : minPrice} // ÂÖÅË®±Ê∏ÖÁ©∫
                      onChange={handleMinPriceChange}
                      onBlur={() => {
                        if (minPrice === "" || isNaN(minPrice)) {
                          setMinPrice(0);
                          priceSliderRef.current?.noUiSlider.set([0, maxPrice]);
                        }
                      }}
                    />
                    <span>ÂÖÉ</span>
                  </div>
                  <div className={styles.suPriceInput}>
                    <label htmlFor="filterMax">ÊúÄÂ§ö</label>
                    <input
                      id="filterMax"
                      type="number"
                      value={maxPrice === "" ? "" : maxPrice}
                      onChange={handleMaxPriceChange}
                      onBlur={() => {
                        if (maxPrice === "" || isNaN(maxPrice)) {
                          setMaxPrice(10000);
                          priceSliderRef.current?.noUiSlider.set([
                            minPrice,
                            10000,
                          ]);
                        }
                      }}
                    />
                    <span>ÂÖÉ</span>
                  </div>
                </div>
                <div
                  id="priceRange"
                  ref={priceSliderRef}
                  className="mt-3"
                ></div>
                <button
                  className={`btn btn-outline-danger mt-3 ${styles.suClearFilterBtn}`}
                  onClick={() => {
                    setMinPrice(0);
                    setMaxPrice(10000);
                    if (priceSliderRef.current?.noUiSlider) {
                      priceSliderRef.current.noUiSlider.set([0, 10000]);
                    }
                  }}
                >
                  Ê∏ÖÈô§ÊêúÂ∞ã
                </button>
              </div>

              {/* Âª£ÂëäÂçÄ */}
              <a href="">
                <figure>
                  <img
                    src="/hotel/hotel-images/page-image/hotelad2.png"
                    alt="Âª£Âëä"
                    className="mx-4 img-fluid"
                  />
                </figure>
              </a>
            </aside>

            <section className="col-lg-9">
              <div className={styles.suHotelCard}>
                <img src="/hotel/hotel-uploads/1-outside.png" alt="È£ØÂ∫óÂúñÁâá" />
                <div className={styles.suHotelInfo}>
                  <h5>ÁÉè‰æÜSpring SpaÊ∫´Ê≥âÂ±±Ëéä</h5>
                  <p>ÁÉè‰æÜÊ∫´Ê≥âÂ±±Ëéä‰ΩçÊñºÁÉè‰æÜÔºåË®≠ÊúâÊ∞¥ÁôÇ‰∏≠ÂøÉÂíåÊ∫´Ê≥âÊµ¥Ê±†...</p>
                </div>
                <div className={styles.suPriceBox}>
                  <div className={styles.suReview}>ÂæàÊ£í ‚≠ê 8</div>
                  1,258 ÂâáË©ïË´ñ
                  <button className={styles.suBookBtn}>Êü•ÁúãÂÉπÊ†º</button>
                </div>
              </div>
              <div className={styles.suHotelCard}>
                <img src="/hotel/hotel-uploads/1-outside.png" alt="È£ØÂ∫óÂúñÁâá" />
                <div className={styles.suHotelInfo}>
                  <h5>ÁÉè‰æÜSpring SpaÊ∫´Ê≥âÂ±±Ëéä</h5>
                  <p>ÁÉè‰æÜÊ∫´Ê≥âÂ±±Ëéä‰ΩçÊñºÁÉè‰æÜÔºåË®≠ÊúâÊ∞¥ÁôÇ‰∏≠ÂøÉÂíåÊ∫´Ê≥âÊµ¥Ê±†...</p>
                </div>
                <div className={styles.suPriceBox}>
                  <div className={styles.suReview}>ÂæàÊ£í ‚≠ê 8</div>
                  1,258 ÂâáË©ïË´ñ
                  <button className={styles.suBookBtn}>Êü•ÁúãÂÉπÊ†º</button>
                </div>
              </div>
              <div className={styles.suHotelCard}>
                <img src="/hotel/hotel-uploads/1-outside.png" alt="È£ØÂ∫óÂúñÁâá" />
                <div className={styles.suHotelInfo}>
                  <h5>ÁÉè‰æÜSpring SpaÊ∫´Ê≥âÂ±±Ëéä</h5>
                  <p>ÁÉè‰æÜÊ∫´Ê≥âÂ±±Ëéä‰ΩçÊñºÁÉè‰æÜÔºåË®≠ÊúâÊ∞¥ÁôÇ‰∏≠ÂøÉÂíåÊ∫´Ê≥âÊµ¥Ê±†...</p>
                </div>
                <div className={styles.suPriceBox}>
                  <div className={styles.suReview}>ÂæàÊ£í ‚≠ê 8</div>
                  1,258 ÂâáË©ïË´ñ
                  <button className={styles.suBookBtn}>Êü•ÁúãÂÉπÊ†º</button>
                </div>
              </div>
              <div className={styles.suHotelCard}>
                <img src="/hotel/hotel-uploads/1-outside.png" alt="È£ØÂ∫óÂúñÁâá" />
                <div className={styles.suHotelInfo}>
                  <h5>ÁÉè‰æÜSpring SpaÊ∫´Ê≥âÂ±±Ëéä</h5>
                  <p>ÁÉè‰æÜÊ∫´Ê≥âÂ±±Ëéä‰ΩçÊñºÁÉè‰æÜÔºåË®≠ÊúâÊ∞¥ÁôÇ‰∏≠ÂøÉÂíåÊ∫´Ê≥âÊµ¥Ê±†...</p>
                </div>
                <div className={styles.suPriceBox}>
                  <div className={styles.suReview}>ÂæàÊ£í ‚≠ê 8</div>
                  1,258 ÂâáË©ïË´ñ
                  <button className={styles.suBookBtn}>Êü•ÁúãÂÉπÊ†º</button>
                </div>
              </div>
              <div className={styles.suHotelCard}>
                <img src="/hotel/hotel-uploads/1-outside.png" alt="È£ØÂ∫óÂúñÁâá" />
                <div className={styles.suHotelInfo}>
                  <h5>ÁÉè‰æÜSpring SpaÊ∫´Ê≥âÂ±±Ëéä</h5>
                  <p>ÁÉè‰æÜÊ∫´Ê≥âÂ±±Ëéä‰ΩçÊñºÁÉè‰æÜÔºåË®≠ÊúâÊ∞¥ÁôÇ‰∏≠ÂøÉÂíåÊ∫´Ê≥âÊµ¥Ê±†...</p>
                </div>
                <div className={styles.suPriceBox}>
                  <div className={styles.suReview}>ÂæàÊ£í ‚≠ê 8</div>
                  1,258 ÂâáË©ïË´ñ
                  <button className={styles.suBookBtn}>Êü•ÁúãÂÉπÊ†º</button>
                </div>
              </div>
              <div className={styles.suHotelCard}>
                <img src="/hotel/hotel-uploads/1-outside.png" alt="È£ØÂ∫óÂúñÁâá" />
                <div className={styles.suHotelInfo}>
                  <h5>ÁÉè‰æÜSpring SpaÊ∫´Ê≥âÂ±±Ëéä</h5>
                  <p>ÁÉè‰æÜÊ∫´Ê≥âÂ±±Ëéä‰ΩçÊñºÁÉè‰æÜÔºåË®≠ÊúâÊ∞¥ÁôÇ‰∏≠ÂøÉÂíåÊ∫´Ê≥âÊµ¥Ê±†...</p>
                </div>
                <div className={styles.suPriceBox}>
                  <div className={styles.suReview}>ÂæàÊ£í ‚≠ê 8</div>
                  1,258 ÂâáË©ïË´ñ
                  <button className={styles.suBookBtn}>Êü•ÁúãÂÉπÊ†º</button>
                </div>
              </div>
              <div className={styles.suHotelCard}>
                <img src="/hotel/hotel-uploads/1-outside.png" alt="È£ØÂ∫óÂúñÁâá" />
                <div className={styles.suHotelInfo}>
                  <h5>ÁÉè‰æÜSpring SpaÊ∫´Ê≥âÂ±±Ëéä</h5>
                  <p>ÁÉè‰æÜÊ∫´Ê≥âÂ±±Ëéä‰ΩçÊñºÁÉè‰æÜÔºåË®≠ÊúâÊ∞¥ÁôÇ‰∏≠ÂøÉÂíåÊ∫´Ê≥âÊµ¥Ê±†...</p>
                </div>
                <div className={styles.suPriceBox}>
                  <div className={styles.suReview}>ÂæàÊ£í ‚≠ê 8</div>
                  1,258 ÂâáË©ïË´ñ
                  <button className={styles.suBookBtn}>Êü•ÁúãÂÉπÊ†º</button>
                </div>
              </div>
              <div className={styles.suHotelCard}>
                <img src="/hotel/hotel-uploads/1-outside.png" alt="È£ØÂ∫óÂúñÁâá" />
                <div className={styles.suHotelInfo}>
                  <h5>ÁÉè‰æÜSpring SpaÊ∫´Ê≥âÂ±±Ëéä</h5>
                  <p>ÁÉè‰æÜÊ∫´Ê≥âÂ±±Ëéä‰ΩçÊñºÁÉè‰æÜÔºåË®≠ÊúâÊ∞¥ÁôÇ‰∏≠ÂøÉÂíåÊ∫´Ê≥âÊµ¥Ê±†...</p>
                </div>
                <div className={styles.suPriceBox}>
                  <div className={styles.suReview}>ÂæàÊ£í ‚≠ê 8</div>
                  1,258 ÂâáË©ïË´ñ
                  <button className={styles.suBookBtn}>Êü•ÁúãÂÉπÊ†º</button>
                </div>
              </div>
            </section>
          </div>
        </div>
        <div className="container page">
          <nav aria-label="Page navigation">
            <ul
              className={`pagination justify-content-center ${styles.suPagination}`}
              id="pagination"
            >
              <li className={`page-item disabled ${styles.pageItem}`}>
                <a
                  className={`page-link ${styles.pageLink}`}
                  href="#"
                  aria-label="Previous"
                  onClick={(e) => e.preventDefault()}
                >
                  <span aria-hidden="true">&laquo;</span>
                </a>
              </li>
              <li className={`page-item active ${styles.pageItemActive}`}>
                <a
                  className={`page-link ${styles.pageLink}`}
                  href="#"
                  onClick={(e) => e.preventDefault()}
                >
                  1
                </a>
              </li>
              <li className={`page-item ${styles.pageItem}`}>
                <a
                  className={`page-link ${styles.pageLink}`}
                  href="#"
                  onClick={(e) => e.preventDefault()}
                >
                  2
                </a>
              </li>
              <li className={`page-item ${styles.pageItem}`}>
                <a
                  className={`page-link ${styles.pageLink}`}
                  href="#"
                  aria-label="Next"
                  onClick={(e) => e.preventDefault()}
                >
                  <span aria-hidden="true" className={styles.pageLink}>&raquo;</span>
                </a>
              </li>
            </ul>
          </nav>
        </div>
      </div>
    </>
  );
}
